<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ§¢</text></svg>">
    <title>Resume - James L Forsyth (Online)</title>
    <style>
        :root {
            --block-size: 30px; /* Default size, will be updated by JS */
        }
        /* Base styles for desktop (horizontal layout) */
        body {
            background-color: #000000;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: row;
            overflow: hidden; /* Prevents scrolling on desktop */
            font-family: sans-serif;
        }
        .resume-container {
            flex: 0 0 70%;
            height: 100%;
            position: relative;
        }
        .arcade-container {
            flex: 0 0 30%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            overflow: auto; 
            padding: calc(var(--block-size) * 0.53) calc(var(--block-size) * 0.33) calc(var(--block-size) * 0.33) calc(var(--block-size) * 0.33); 
            box-sizing: border-box;
        }
        .game-unit {
            position: relative;
            display: flex; 
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 100%;
            border-radius: 0;
            box-sizing: border-box; 
            transition: width 0.1s ease, height 0.1s ease;
            overflow: hidden;
        }
        /* The display area for the game iframe */
        .app-display-area {
            flex-grow: 1;
            height: 100%;
            overflow: hidden;
            position: relative;
            box-sizing: border-box;
            border: 3px solid #663399 
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            overflow: hidden;
        }
        iframe.app-frame { display: none; }
        iframe.app-frame.active { display: block; }

        /* Minimum resolution message */
        .min-resolution-message {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            z-index: 5;
            font-size: 18px;
            line-height: 1.5;
        }
        .min-resolution-message.active {
            display: flex;
        }

        /* Tabs have a fixed width and sit next to the display area */
        .tabs-container {
	        flex-shrink: 0;
	        width: calc(var(--block-size) * 1.1);
	        height: 100%;
	        display: flex;
	        flex-direction: column;
	        align-items: center;
	        padding-top: calc(var(--block-size) * 0.63);
	        box-sizing: border-box;
	        transition: width 0.1s ease, padding-top 0.1s ease;
	        padding-right: calc(var(--block-size) * 0.07);
        }

        .tab {
            writing-mode: vertical-rl;
            transform: rotate(0deg); /* Text reads from top to bottom */
            cursor: pointer;
            padding: calc(var(--block-size) * 0.5) calc(var(--block-size) * 0.17);
            margin-bottom: calc(var(--block-size) * 0.33);
            border-radius: 0 8px 8px 0; /* Rounded corners on right side, flat on left */
            font-weight: bold;
            font-size: calc(var(--block-size) * 0.53);
            color: white;
            background-color: #9A73C9;
            transition: all 0.1s ease;
            text-orientation: mixed; /* Keeps letters upright */
        }
        .tab.active {
            background-color: #663399; 
        }

        /* --- Mobile UI Overlays and Scroll Arrows --- */
        .scroll-arrow, .scroll-arrow-square, #gameControls {
            position: absolute;
            display: none;
            z-index: 10;
        }
        .scroll-arrow {
            left: 0;
            width: 100%;
            height: 60px;
            background: rgba(0, 0, 0, 0.4);
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        #scrollDownBtn { bottom: 0; }
        
        .scroll-arrow-square {
            top: 15px;
            right: 15px;
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.4);
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        #gameControls {
            bottom: 0;
            left: 0;
            width: 100%;
            height: 47px;
            background: rgba(0, 0, 0, 0.4);
            display: none;
            justify-content: space-around;
            align-items: center;
        }
        #gameControls .control-btn {
            width: 45px;          
            height: 45px;         
            font-size: 0.5rem;
            background: transparent;
            border: none;
            color: white;
            flex-grow: 1;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .control-btn:active { transform: scale(0.95); background: rgba(255, 255, 255, 0.2); }
        .control-btn:not(:last-child) { border-right: 1px solid rgba(255, 255, 255, 0.2); }

        /* --- Media Query for Mobile Devices --- */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
                overflow-y: scroll;
                scroll-snap-type: y mandatory;
            }
            .resume-container, .arcade-container {
                flex: none;
                width: 100%;
                height: 100vh;
                scroll-snap-align: start;
            }
            .arcade-container {
                padding: calc(var(--block-size) * 0.53) calc(var(--block-size) * 0.33) calc(var(--block-size) * 0.33) calc(var(--block-size) * 0.33);
                background-color: #222;
                overflow: auto;
            }
            .game-unit {
                flex-direction: column;
                border-radius: 0;
                width: 100% !important;
                height: 100% !important;
                max-width: 100%;
                max-height: 100%;
                aspect-ratio: unset;
                box-sizing: border-box;
            }
            .scroll-arrow, .scroll-arrow-square { display: flex; }
            
            .app-display-area {
                order: 2; 
                margin-top: -10px; /* This pulls the area up to create the overlap */
                z-index: 2; /* This ensures the game area is on top */
                max-height: 758px; 
                border: 3px solid #663399; 
                background-color: #000;
            }
            
            .tabs-container {
                order: 1;
                position: sticky;
                top: 0;
                width: 100%;
                height: auto;
                flex-direction: row;
                justify-content: center;
                background-color: #000;
                padding: 13px 4px 4px !important;
                z-index: 1;
                box-sizing: border-box;
            }

            .tab {
                writing-mode: horizontal-tb;
                transform: none;
                text-orientation: unset;
                padding: 7px 17px;
                margin: 0 3px; /* Removes bottom margin that creates a gap */
                border-radius: 8px;
            }

            #gameControls { width: 100%; }
            .scroll-arrow-square { right: 15px; } /* Reset position */
        }
    </style>
</head>
<body>
    <div class="resume-container">
        <iframe src="JLF_RESUME.html"></iframe>
        <div id="scrollDownBtn" class="scroll-arrow">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 10L12 15L17 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
    </div>
    
    <div class="arcade-container">
        <div class="game-unit">
            <div class="app-display-area">
                <div class="min-resolution-message" id="minResolutionMessage">
                    <div>
                        <h3>Screen Too Small</h3>
                        <p>Please increase your browser window size to play this game.</p>
                        <p>Minimum required resolution: 350x700</p>
                    </div>
                </div>
                
                <iframe id="blocks-iframe" class="app-frame" data-appid="blocks"></iframe>
                <iframe id="invaders-iframe" class="app-frame" data-appid="invaders"></iframe>
                <div id="scrollUpBtn" class="scroll-arrow-square">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17 14L12 9L7 14" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                </div>
                <div id="gameControls">
                    <button class="control-btn" data-code="ArrowLeft"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 19L8 12L15 5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                    <button class="control-btn" data-code="ArrowUp"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 15L12 8L19 15" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                    <button class="control-btn" data-code="Space" style="font-size: 16px; font-weight: bold;">â–¡</button>
                    <button class="control-btn" data-code="ArrowDown"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19 9L12 16L5 9" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                    <button class="control-btn" data-code="ArrowRight"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 5L16 12L9 19" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                </div>
            </div>
            <div class="tabs-container">
                <div class="tab active" data-appid="invaders">Invaders</div>
                <div class="tab" data-appid="blocks">Blocks</div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Easy Origin Switch ---
            // Set to true when deploying to GitHub pages, false for local development
            var IS_PRODUCTION = false;
            var TARGET_ORIGIN = IS_PRODUCTION ? 'https://jamesworldbuilder.github.io' : '*';

            var appConfig = {
                'invaders': {
                    url: './Render_Cloud_setup/space-invaders-game/space-invaders-game.html', //https://space-invaders-game-4fnq.onrender.com
                    iframe: document.getElementById('invaders-iframe'),
                    origin: TARGET_ORIGIN,
                    isLoaded: false
                },
                'blocks': {
                    url: './Render_Cloud_setup/tetris-game/tetris-game.html', //https://tetris-game-bo8x.onrender.com
                    iframe: document.getElementById('blocks-iframe'),
                    origin: TARGET_ORIGIN,
                    isLoaded: false
                }
            };
            
            var currentAppId = 'invaders';
            var tabsContainer = document.querySelector('.tabs-container');
            var allTabs = document.querySelectorAll('.tab');
            var gameUnit = document.querySelector('.game-unit');
            var root = document.documentElement;
            var minResolutionMessage = document.getElementById('minResolutionMessage');
            var appDisplayArea = document.querySelector('.app-display-area');

            var minWidth = 350;
            var minHeight = 700;

            // Track if resolution is currently too small
            var isResolutionTooSmall = false;
            var resizeTimeout;

            // Function to check and update resolution message based on app-display-area
            function checkResolution() {
                // Skip resolution checks on mobile devices
                if (window.matchMedia("(max-width: 768px)").matches) {
                    minResolutionMessage.classList.remove('active');
                    isResolutionTooSmall = false;
                    return;
                }

                var displayAreaRect = appDisplayArea.getBoundingClientRect();
                var displayAreaWidth = displayAreaRect.width;
                var displayAreaHeight = displayAreaRect.height;
                
                var wasTooSmall = isResolutionTooSmall;
                
                // Show minimum resolution message if display area is too small (desktop only)
                if (displayAreaWidth < minWidth || displayAreaHeight < minHeight) {
                    minResolutionMessage.classList.add('active');
                    isResolutionTooSmall = true;
                    
                    // If resolution becomes too small, unload iframes
                    if (!wasTooSmall) {
                        unloadAllIframes();
                    }
                } else {
                    minResolutionMessage.classList.remove('active');
                    isResolutionTooSmall = false;
                    
                    // If resolution becomes adequate, reload current app
                    if (wasTooSmall) {
                        reloadCurrentApp();
                    }
                }
            }

            // Function to unload all iframes when resolution is too small
            function unloadAllIframes() {
                for (var appId in appConfig) {
                    var app = appConfig[appId];
                    if (app.isLoaded) {
                        // Replace iframe with a blank page to stop execution
                        app.iframe.src = 'about:blank';
                        app.isLoaded = false;
                    }
                }
            }

            // Function to unload a specific app
            function unloadApp(appId) {
                var app = appConfig[appId];
                if (app && app.isLoaded) {
                    app.iframe.src = 'about:blank';
                    app.isLoaded = false;
                }
            }

            // Function to reload the current app
            function reloadCurrentApp() {
                var currentApp = appConfig[currentAppId];
                if (currentApp && !currentApp.isLoaded) {
                    currentApp.iframe.src = currentApp.url;
                    currentApp.isLoaded = true;
                }
            }

            // Function to load a specific app
            function loadApp(appId) {
                var app = appConfig[appId];
                if (app && !app.isLoaded && !isResolutionTooSmall) {
                    app.iframe.src = app.url;
                    app.isLoaded = true;
                }
            }

            // Function to show mobile controls
            function showMobileControls() {
                if (window.matchMedia("(max-width: 768px)").matches) {
                    const scrollUpBtn = document.querySelector('#scrollUpBtn');
                    const gameControls = document.querySelector('#gameControls');
                    scrollUpBtn.style.display = 'flex';
                    gameControls.style.display = 'flex';
                }
            }

            // Function to hide mobile controls
            function hideMobileControls() {
                if (window.matchMedia("(max-width: 768px)").matches) {
                    const scrollUpBtn = document.querySelector('#scrollUpBtn');
                    const gameControls = document.querySelector('#gameControls');
                    scrollUpBtn.style.display = 'flex';
                    gameControls.style.display = 'none';
                }
            }

            window.addEventListener('message', function(event) {
                const activeApp = appConfig[currentAppId];

                // Validate origin
                if (!activeApp || (activeApp.origin !== '*' && event.origin !== 'null' && event.origin !== activeApp.origin)) {
                    return;
                }

                // Block size updates and scaling logic
                if (event.data && event.data.type === 'canvasPosition') {
                    root.style.setProperty('--block-size', event.data.blockSize + 'px');

                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(checkResolution, 100);

                    if (!window.matchMedia("(max-width: 768px)").matches) {
                        const arcadeContainerRect = gameUnit.parentElement.getBoundingClientRect();
                        const gameUnitHeight = (event.data.offsetWidth / 10) * 20;
                        const spaceAboveGameUnit = (arcadeContainerRect.height - gameUnitHeight) / 2;
                        const finalOffset = spaceAboveGameUnit + event.data.offsetTop;
                        tabsContainer.style.paddingTop = Math.max(0, finalOffset) + 'px';
                    }
                }

                // Mark app as loaded when it sends messages
                if (activeApp && !activeApp.isLoaded) {
                    activeApp.isLoaded = true;
                }

                // --- Mobile-specific behavior ---
                // Show controls when iframe sends "startButtonPressed" or "gameStarted"
                if (event.data === 'startButtonPressed' || event.data === 'gameStarted') {
                    showMobileControls();
                }

                // Hide controls when iframe sends "gameEnded"
                if (event.data === 'gameEnded') {
                    hideMobileControls();
                }
            });


            // Check resolution on window resize
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(checkResolution, 250);
            });
            
            window.addEventListener('load', checkResolution);

            function switchApp(newAppId) {
                if (!appConfig[newAppId]) return;
                
                var oldAppId = currentAppId;
                
                // Unload the currently active app if it's different from the new one
                if (oldAppId && oldAppId !== newAppId && appConfig[oldAppId]) {
                    unloadApp(oldAppId);
                    appConfig[oldAppId].iframe.classList.remove('active');
                    // Hide controls when switching apps
                    hideMobileControls();
                }
                
                allTabs.forEach(function(tab) {
                    tab.classList.toggle('active', tab.dataset.appid === newAppId);
                });
                
                var newApp = appConfig[newAppId];
                newApp.iframe.classList.add('active');
                currentAppId = newAppId;
                
                // Only load the app if resolution is adequate (or on mobile)
                if (!isResolutionTooSmall || window.matchMedia("(max-width: 768px)").matches) {
                    loadApp(newAppId);
                }
                
                // Check resolution after switching apps
                setTimeout(checkResolution, 100);
            }

            tabsContainer.addEventListener('click', function(event) {
                var clickedTab = event.target.closest('.tab');
                if (clickedTab && clickedTab.dataset.appid !== currentAppId) {
                    switchApp(clickedTab.dataset.appid);
                }
            });

            // Game controls event listener - Setup regardless of device
            document.querySelector('#gameControls').addEventListener('click', function(event) {
                const button = event.target.closest('.control-btn');
                const activeApp = appConfig[currentAppId];
                if (button && button.dataset.code && activeApp && activeApp.iframe.classList.contains('active') && activeApp.isLoaded) {
                    const message = { type: 'keydown', code: button.dataset.code };
                    activeApp.iframe.contentWindow.postMessage(message, activeApp.origin);
                    setTimeout(() => {
                        const upMessage = { type: 'keyup', code: button.dataset.code };
                        activeApp.iframe.contentWindow.postMessage(upMessage, activeApp.origin);
                    }, 100);
                }
            });

            if (window.matchMedia("(max-width: 768px)").matches) {
                const scrollDownBtn = document.getElementById('scrollDownBtn');
                const scrollUpBtn = document.getElementById('scrollUpBtn');
                const arcadeContainer = document.querySelector('.arcade-container');
                const resumeContainer = document.querySelector('.resume-container');

                // Enable scroll snapping on the body
                document.body.style.scrollSnapType = 'y mandatory';
                resumeContainer.style.scrollSnapAlign = 'start';
                arcadeContainer.style.scrollSnapAlign = 'start';

                // Scroll with snap alignment
                scrollDownBtn.addEventListener('click', () => {
                    arcadeContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });

                scrollUpBtn.addEventListener('click', () => {
                    resumeContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });

                // Initially hide controls on mobile (show when game starts)
                hideMobileControls();
            }

            // Initial resolution check and app load
            setTimeout(function() {
                checkResolution();
                // Always load app on mobile, only load if resolution is adequate on desktop
                if (!isResolutionTooSmall || window.matchMedia("(max-width: 768px)").matches) {
                    switchApp(currentAppId);
                }
            }, 500);
        });
    </script>
</body>
</html>
